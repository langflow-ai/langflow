version: '3.8'

services:
  # AI Studio Frontend with Keycloak Authentication Testing
  ai-studio-frontend-keycloak:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        BACKEND_URL: https://genesis.dev-v2.platform.autonomize.dev/genesis-platform/bff
    container_name: ai-studio-frontend-keycloak-test
    ports:
      - "3000:3000"
    environment:
      # Backend Configuration
      BACKEND_URL: "https://genesis.dev-v2.platform.autonomize.dev/genesis-platform/bff"
      FRONTEND_PORT: 3000
      LANGFLOW_MAX_FILE_SIZE_UPLOAD: 100

      # Application Configuration
      VITE_BACKEND_URL: "https://genesis.dev-v2.platform.autonomize.dev/genesis-platform/bff"
      VITE_API_PREFIX: "/api/v1/genesis-studio"
      VITE_PROXY_TARGET: "https://genesis.dev-v2.platform.autonomize.dev/genesis-platform/bff"
      VITE_PORT: "3000"
      VITE_APP_TITLE: "AI Studio - Keycloak Test"
      VITE_BUILD_VERSION: "keycloak-test"

      # Feature Flags
      VITE_ENABLE_CHAT: "true"
      VITE_ENABLE_AGENT_BUILDER: "true"
      VITE_ENABLE_HEALTHCARE_COMPONENTS: "true"

      # Debug Configuration
      VITE_DEBUG_MODE: "true"
      VITE_LOG_LEVEL: "debug"

      # Keycloak Authentication Configuration (ENABLED)
      VITE_KEYCLOAK_ENABLED: "true"
      VITE_KEYCLOAK_URL: "https://genesis.dev-v2.platform.autonomize.dev/genesis-platform/auth/"
      VITE_KEYCLOAK_REALM: "autonomize"
      VITE_KEYCLOAK_CLIENT_ID: "ai-studio-frontend"

      # Optional Advanced Configuration
      VITE_WEBSOCKET_URL: ""
      VITE_MAX_FILE_SIZE: ""
      VITE_TIMEOUT: ""
    volumes:
      - /tmp/frontend-logs:/var/log/nginx
    networks:
      - ai-studio-test
    restart: unless-stopped

  # AI Studio Frontend with Traditional Authentication Testing (disabled for now)
  # ai-studio-frontend-traditional:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile
  #     args:
  #       BACKEND_URL: http://localhost:7860
  #   container_name: ai-studio-frontend-traditional-test
  #   ports:
  #     - "3002:3000"
  #   environment:
  #     # Backend Configuration
  #     BACKEND_URL: "http://localhost:7860"
  #     FRONTEND_PORT: 3000
  #     LANGFLOW_MAX_FILE_SIZE_UPLOAD: 100
  #     # Application Configuration
  #     VITE_BACKEND_URL: "http://localhost:7860"
  #     VITE_API_PREFIX: "/api/v1"
  #     VITE_PROXY_TARGET: "http://localhost:7860"
  #     VITE_PORT: "3000"
  #     VITE_APP_TITLE: "AI Studio - Traditional Test"
  #     VITE_BUILD_VERSION: "traditional-test"
  #     # Feature Flags
  #     VITE_ENABLE_CHAT: "true"
  #     VITE_ENABLE_AGENT_BUILDER: "true"
  #     VITE_ENABLE_HEALTHCARE_COMPONENTS: "true"
  #     # Debug Configuration
  #     VITE_DEBUG_MODE: "true"
  #     VITE_LOG_LEVEL: "debug"
  #     # Keycloak Authentication Configuration (DISABLED)
  #     VITE_KEYCLOAK_ENABLED: "false"
  #     VITE_KEYCLOAK_URL: ""
  #     VITE_KEYCLOAK_REALM: ""
  #     VITE_KEYCLOAK_CLIENT_ID: ""
  #     # Optional Advanced Configuration
  #     VITE_WEBSOCKET_URL: ""
  #     VITE_MAX_FILE_SIZE: ""
  #     VITE_TIMEOUT: ""
  #   volumes:
  #     - /tmp/frontend-logs:/var/log/nginx
  #   networks:
  #     - ai-studio-test
  #   restart: unless-stopped

  # Mock Backend for Testing API Requests
  mock-backend:
    image: nginx:alpine
    container_name: ai-studio-mock-backend
    ports:
      - "7860:80"
    volumes:
      - ./test-backend-config.json:/usr/share/nginx/html/test-config.json
      - ./mock-backend.conf:/etc/nginx/conf.d/default.conf
    networks:
      - ai-studio-test
    restart: unless-stopped

networks:
  ai-studio-test:
    driver: bridge

volumes:
  frontend-logs:
    driver: local