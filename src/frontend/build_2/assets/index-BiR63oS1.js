import{U as le,a as ce,g as oe,r as i,j as e,c as N,C as pe,A as de,B as M,n as fe,$ as je,b as P,d as $,e as L,f as F,E as Z,h as Q,i as Y,k as K,l as Ne,P as ee,m as se,u as te,o as ge,p as ve,F as O,q as Ce,I as be,s as we,S as W,t as u,v as ae,w as Se,x as _e,y as Ee,z as Te,D as q,G as J,H as ne,J as ie,K as Ue}from"./index-CUA5Soss.js";import{u as ye}from"./use-post-add-user-22kBcRLU.js";const Re=r=>{const{mutate:l}=le();return l(["useDeleteUsers"],async({user_id:x})=>(await ce.delete(`${oe("USERS")}/${x}`)).data,r)},Ae=r=>{const{mutate:l}=le();async function c({skip:x,limit:g}){const n=await ce.get(`${oe("USERS")}/?skip=${x}&limit=${g}`);return n.status===200?n.data:[]}return l(["useGetUsers"],c,r)},me=i.forwardRef(({className:r,...l},c)=>e.jsx("div",{className:"",children:e.jsx("table",{ref:c,className:N("w-full caption-bottom text-sm",r),...l})}));me.displayName="Table";const ue=i.forwardRef(({className:r,...l},c)=>e.jsx("thead",{ref:c,className:N("[&_tr]:border-b",r),...l}));ue.displayName="TableHeader";const xe=i.forwardRef(({className:r,...l},c)=>e.jsx("tbody",{ref:c,className:N("[&_tr:last-child]:border-0",r),...l}));xe.displayName="TableBody";const Ie=i.forwardRef(({className:r,...l},c)=>e.jsx("tfoot",{ref:c,className:N("bg-primary font-medium text-primary-foreground",r),...l}));Ie.displayName="TableFooter";const X=i.forwardRef(({className:r,...l},c)=>e.jsx("tr",{ref:c,className:N("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...l}));X.displayName="TableRow";const f=i.forwardRef(({className:r,...l},c)=>e.jsx("th",{ref:c,className:N("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...l}));f.displayName="TableHead";const j=i.forwardRef(({className:r,...l},c)=>e.jsx("td",{ref:c,className:N("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...l}));j.displayName="TableCell";const De=i.forwardRef(({className:r,...l},c)=>e.jsx("caption",{ref:c,className:N("mt-4 text-sm text-muted-foreground",r),...l}));De.displayName="TableCaption";function re({title:r,titleHeader:l,cancelText:c,confirmationText:E,children:x,icon:g,data:n,index:v,onConfirm:G,asChild:z}){const H=fe[g],[C,b]=i.useState(!1),[w,d]=i.useState(!1),[U,m]=i.useState(!1),[h,S]=i.useState((n==null?void 0:n.password)??""),[y,T]=i.useState((n==null?void 0:n.username)??""),[_,p]=i.useState((n==null?void 0:n.password)??""),[R,A]=i.useState((n==null?void 0:n.is_active)??!1),[I,D]=i.useState((n==null?void 0:n.is_superuser)??!1),[B,V]=i.useState(pe),{userData:s}=i.useContext(de);function a({target:{name:t,value:k}}){V(he=>({...he,[t]:k}))}i.useEffect(()=>{U&&(n?(T(n.username),A(n.is_active),D(n.is_superuser),a({target:{name:"username",value:y}}),a({target:{name:"is_active",value:R}}),a({target:{name:"is_superuser",value:I}})):o())},[U]);function o(){S(""),T(""),p(""),A(!1),D(!1)}return e.jsxs(M,{size:"medium-h-full",open:U,setOpen:m,children:[e.jsx(M.Trigger,{asChild:z,children:x}),e.jsxs(M.Header,{description:l,children:[e.jsx("span",{className:"pr-2",children:r}),e.jsx(H,{name:"icon",className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(M.Content,{children:e.jsxs(je,{onSubmit:t=>{if(h!==_){t.preventDefault();return}o(),G(1,B),m(!1),t.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(P,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs($,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{a({target:{name:"username",value:t}}),T(t)},value:y,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(F,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(P,{name:"password",serverInvalid:h!=_,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs($,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),C&&e.jsx(Z,{onClick:()=>b(!C),className:"h-5 cursor-pointer",strokeWidth:1.5}),!C&&e.jsx(Q,{onClick:()=>b(!C),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{a({target:{name:"password",value:t}}),S(t)},value:h,className:"primary-input",required:!n,type:C?"text":"password"})}),e.jsx(F,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),h!=_&&e.jsx(F,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(P,{name:"confirmpassword",serverInvalid:h!=_,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs($,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),w&&e.jsx(Z,{onClick:()=>d(!w),className:"h-5 cursor-pointer",strokeWidth:1.5}),!w&&e.jsx(Q,{onClick:()=>d(!w),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx(L,{asChild:!0,children:e.jsx("input",{onChange:t=>{p(t.target.value)},value:_,className:"primary-input",required:!n,type:w?"text":"password"})}),e.jsx(F,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(P,{name:"is_active",children:e.jsxs("div",{children:[e.jsx($,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx(L,{asChild:!0,children:e.jsx(Y,{value:R,checked:R,id:"is_active",className:"relative top-0.5",onCheckedChange:t=>{a({target:{name:"is_active",value:t}}),A(t)}})})]})}),(s==null?void 0:s.is_superuser)&&e.jsx(P,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx($,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx(L,{asChild:!0,children:e.jsx(Y,{checked:I,value:I,id:"is_superuser",className:"relative top-0.5",onCheckedChange:t=>{a({target:{name:"is_superuser",value:t}}),D(t)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(K,{variant:"outline",onClick:()=>{m(!1)},className:"mr-3",children:c}),e.jsx(Ne,{asChild:!0,children:e.jsx(K,{className:"mt-8",children:E})})]})]})})]})}function $e(){const[r,l]=i.useState(""),[c,E]=i.useState(ee),[x,g]=i.useState(se),n=te(s=>s.setSuccessData),v=te(s=>s.setErrorData),{userData:G}=i.useContext(de),[z,H]=i.useState(0),{mutate:C}=Re(),{mutate:b}=ge(),{mutate:w}=ye(),d=i.useRef([]);i.useEffect(()=>{setTimeout(()=>{T()},500)},[]);const[U,m]=i.useState(d.current),{mutate:h,isPending:S,isIdle:y}=Ae({});function T(){h({skip:c*(x-1),limit:c},{onSuccess:s=>{H(s.total_count),d.current=s.users,m(s.users)},onError:()=>{}})}function _(s,a){E(a),g(s),h({skip:a*(s-1),limit:a},{onSuccess:o=>{H(o.total_count),d.current=o.users,m(o.users)}})}function p(){g(se),E(ee),T()}function R(s){if(l(s),s==="")m(d.current);else{const a=d.current.filter(o=>o.username.toLowerCase().includes(s.toLowerCase()));m(a)}}function A(s){C({user_id:s.id},{onSuccess:()=>{p(),n({title:Te})},onError:a=>{v({title:Ee,list:[a.response.data.detail]})}})}function I(s,a){b({user_id:s,user:a},{onSuccess:()=>{p(),n({title:J})},onError:o=>{v({title:q,list:[o.response.data.detail]})}})}function D(s,a,o){const t=ne.cloneDeep(o);t.is_active=!s,b({user_id:a,user:t},{onSuccess:()=>{p(),n({title:J})},onError:k=>{v({title:q,list:[k.response.data.detail]})}})}function B(s,a,o){const t=ne.cloneDeep(o);t.is_superuser=!s,b({user_id:a,user:t},{onSuccess:()=>{p(),n({title:J})},onError:k=>{v({title:q,list:[k.response.data.detail]})}})}function V(s){w(s,{onSuccess:a=>{b({user_id:a.id,user:{is_active:s.is_active,is_superuser:s.is_superuser}},{onSuccess:()=>{p(),n({title:Ue})},onError:o=>{v({title:ie,list:[o.response.data.detail]})}})},onError:a=>{v({title:ie,list:[a.response.data.detail]})}})}return e.jsx(e.Fragment,{children:G&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(O,{name:"Shield",className:"w-6"}),ve]})}),e.jsx("span",{className:"admin-page-description-text",children:Ce}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(be,{placeholder:"Search Username",value:r,onChange:s=>R(s.target.value)}),r.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{l(""),m(d.current)},children:e.jsx(O,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(O,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(re,{title:"New User",titleHeader:"Add a new user",cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",onConfirm:(s,a)=>{V(a)},asChild:!0,children:e.jsx(K,{variant:"primary",children:"New User"})})})]}),S||y?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(we,{remSize:12})}):d.current.length===0&&!y?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-fit overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(S?" border-0":""),children:e.jsxs(me,{className:"table-fixed outline-1",children:[e.jsx(ue,{className:S?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(X,{children:[e.jsx(f,{className:"h-10",children:"Id"}),e.jsx(f,{className:"h-10",children:"Username"}),e.jsx(f,{className:"h-10",children:"Active"}),e.jsx(f,{className:"h-10",children:"Superuser"}),e.jsx(f,{className:"h-10",children:"Created At"}),e.jsx(f,{className:"h-10",children:"Updated At"}),e.jsx(f,{className:"h-10 w-[100px] text-right"})]})}),!S&&e.jsx(xe,{children:U.map((s,a)=>e.jsxs(X,{children:[e.jsx(j,{className:"truncate py-2 font-medium",children:e.jsx(W,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(j,{className:"truncate py-2",children:e.jsx(W,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(j,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(u,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(o,t)=>{D(t.is_active,t.id,t)},children:[e.jsx(u.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(u.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ae,{checked:s.is_active})})})]})}),e.jsx(j,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(u,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:a,onConfirm:(o,t)=>{B(t.is_superuser,t.id,t)},children:[e.jsx(u.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(u.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ae,{checked:s.is_superuser})})})]})}),e.jsx(j,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(j,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(j,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(re,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:a,onConfirm:(o,t)=>{I(s.id,t)},children:e.jsx(W,{content:"Edit",side:"top",children:e.jsx(O,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(u,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:a,onConfirm:(o,t)=>{A(t)},children:[e.jsx(u.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(u.Trigger,{children:e.jsx(O,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},a))})]})}),e.jsx(Se,{pageIndex:x,pageSize:c,totalRowsCount:z,paginate:_,rowsCount:_e})]})]})})}export{$e as default};
