name: ðŸ§ª test invoke ephemeral runner
on:
  push: 
    branches: [test-ephemeral-runner]

jobs:
  show-runner-info:
    runs-on: 
      labels: ["self-hosted", "linux", "ARM64", "langflow-ai-arm64-40gb-ephemeral"]        
    steps:

      - name: Print runner labels from context
        run: | 
      
      - name: Get runner labels from API 
        run: |
          RUNNER_NAME="${{ runner.name }}"
          ORG="${{ github.repository_owner }}"
          
          # Get runner labels via API
          LABELS=$(curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            "https://api.github.com/orgs/$ORG/actions/runners" | \
            jq -r ".runners[] | select(.name == \"$RUNNER_NAME\") | .labels[].name")
    
            echo "Runner labels: $LABELS " >> "$GITHUB_STEP_SUMMARY"
          
      - name: Show Runner Info in Summary
        run: |
          {
            echo "## ðŸ–¥ï¸ Self-Hosted Runner Info"
            echo "---------- "
            echo "GITHUB_RUNNER_NAME   : '${{ runner.name }}'"
            echo "GITHUB_RUNNER_OS     : '${{ runner.os }}'"
            echo "ENV RUNNER_NAME      : '$RUNNER_NAME'"            
            echo "----------"
            echo "**Hostname:** $(hostname)"
            echo "**Machine:** $(uname -a)"
            echo "**GitHub Workspace:** $GITHUB_WORKSPACE"
            echo "**Runner Temp Dir:** $RUNNER_TEMP"
            echo "**Runner Tool Cache:** $RUNNER_TOOL_CACHE"
            echo ""
            echo "### Environment Variables"
            echo '```'
            printenv | sort
            echo '```'
          } >> "$GITHUB_STEP_SUMMARY"
