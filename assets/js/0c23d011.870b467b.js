"use strict";(globalThis.webpackChunklangflow_docs=globalThis.webpackChunklangflow_docs||[]).push([[8611],{11470:(e,n,t)=>{t.d(n,{A:()=>w});var s=t(96540),r=t(18215),o=t(17559),a=t(23104),i=t(56347),c=t(205),d=t(57485),l=t(31682),h=t(70679);function m(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return m(e).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s}))}(t);return function(e){const n=(0,l.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function x({queryString:e=!1,groupId:n}){const t=(0,i.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,d.aZ)(r),(0,s.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})},[r,t])]}function g(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,o=u(e),[a,i]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:o})),[d,l]=x({queryString:t,groupId:r}),[m,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,h.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),j=(()=>{const e=d??m;return p({value:e,tabValues:o})?e:null})();(0,c.A)(()=>{j&&i(j)},[j]);return{selectedValue:a,selectValue:(0,s.useCallback)(e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);i(e),l(e),g(e)},[l,g,o]),tabValues:o}}var j=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var y=t(74848);function b({className:e,block:n,selectedValue:t,selectValue:s,tabValues:o}){const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,r=i.indexOf(n),a=o[r].value;a!==t&&(c(n),s(a))},l=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;n=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;n=i[t]??i[i.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:o.map(({value:e,label:n,attributes:s})=>(0,y.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{i.push(e)},onKeyDown:l,onClick:d,...s,className:(0,r.A)("tabs__item",f.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const o=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=o.find(e=>e.props.value===t);return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:o.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function M(e){const n=g(e);return(0,y.jsxs)("div",{className:(0,r.A)(o.G.tabs.container,"tabs-container",f.tabList),children:[(0,y.jsx)(b,{...n,...e}),(0,y.jsx)(v,{...n,...e})]})}function w(e){const n=(0,j.A)();return(0,y.jsx)(M,{...e,children:m(e.children)},String(n))}},19365:(e,n,t)=>{t.d(n,{A:()=>a});t(96540);var s=t(18215);const r={tabItem:"tabItem_Ymn6"};var o=t(74848);function a({children:e,hidden:n,className:t}){return(0,o.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,t),hidden:n,children:e})}},31929:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>a});var s=t(74848),r=t(28453),o=t(40619);const a=[];function i(e){const n={a:"a",p:"p",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(n.p,{children:["Some parameters are hidden by default in the visual editor.\nYou can modify all parameters through the ",(0,s.jsx)(o.A,{name:"SlidersHorizontal","aria-hidden":"true"})," ",(0,s.jsx)(n.strong,{children:"Controls"})," in the ",(0,s.jsx)(n.a,{href:"/concepts-components#component-menus",children:"component's header menu"}),"."]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},76050:(e,n,t)=>{t.r(n),t.d(n,{CH:()=>p,assets:()=>u,chCodeConfig:()=>x,contentTitle:()=>m,default:()=>f,frontMatter:()=>h,metadata:()=>s,toc:()=>g});const s=JSON.parse('{"id":"Components/message-history","title":"Message History","description":"The Message History component provides combined chat history and message storage functionality.","source":"@site/docs/Components/message-history.mdx","sourceDirName":"Components","slug":"/message-history","permalink":"/message-history","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Message History","slug":"/message-history"},"sidebar":"docs","previous":{"title":"Embedding Model","permalink":"/components-embedding-models"},"next":{"title":"Calculator","permalink":"/calculator"}}');var r=t(74848),o=t(28453),a=t(24754),i=t(40619),c=t(11470),d=t(19365),l=t(31929);const h={title:"Message History",slug:"/message-history"},m=void 0,u={},p={annotations:a.hk,Code:a.Cy},x={staticMediaQuery:"not screen, (max-width: 768px)",lineNumbers:!0,showCopyButton:!0,themeName:"github-dark"},g=[{value:"Use the Message History component in a flow",id:"use-the-message-history-component-in-a-flow",level:2},{value:"Message History parameters",id:"message-history-parameters",level:2},...l.RM,{value:"Message History output",id:"message-history-output",level:2}];function j(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return p||y("CH",!1),p.Code||y("CH.Code",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("style",{dangerouslySetInnerHTML:{__html:'[data-ch-theme="github-dark"] {  --ch-t-colorScheme: dark;--ch-t-foreground: #c9d1d9;--ch-t-background: #0d1117;--ch-t-lighter-inlineBackground: #0d1117e6;--ch-t-editor-background: #0d1117;--ch-t-editor-foreground: #c9d1d9;--ch-t-editor-lineHighlightBackground: #6e76811a;--ch-t-editor-rangeHighlightBackground: #ffffff0b;--ch-t-editor-infoForeground: #3794FF;--ch-t-editor-selectionBackground: #264F78;--ch-t-focusBorder: #1f6feb;--ch-t-tab-activeBackground: #0d1117;--ch-t-tab-activeForeground: #c9d1d9;--ch-t-tab-inactiveBackground: #010409;--ch-t-tab-inactiveForeground: #8b949e;--ch-t-tab-border: #30363d;--ch-t-tab-activeBorder: #0d1117;--ch-t-editorGroup-border: #30363d;--ch-t-editorGroupHeader-tabsBackground: #010409;--ch-t-editorLineNumber-foreground: #6e7681;--ch-t-input-background: #0d1117;--ch-t-input-foreground: #c9d1d9;--ch-t-input-border: #30363d;--ch-t-icon-foreground: #8b949e;--ch-t-sideBar-background: #010409;--ch-t-sideBar-foreground: #c9d1d9;--ch-t-sideBar-border: #30363d;--ch-t-list-activeSelectionBackground: #6e768166;--ch-t-list-activeSelectionForeground: #c9d1d9;--ch-t-list-hoverBackground: #6e76811a;--ch-t-list-hoverForeground: #c9d1d9; }'}}),"\n","\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Message History"})," component provides combined chat history and message storage functionality.\nIt can store and retrieve chat messages from either ",(0,r.jsx)(n.a,{href:"/memory",children:"Langflow storage"})," ",(0,r.jsx)(n.em,{children:"or"})," a dedicated chat memory database like Mem0 or Redis."]}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Agent"})," component has built-in chat memory that is enabled by default and uses Langflow storage.\nThis built-in chat memory functionality is sufficient for most use cases."]}),(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.strong,{children:"Message History"})," component for the following use cases:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You need to store and retrieve chat memory for a language model component (not an agent)."}),"\n",(0,r.jsx)(n.li,{children:"You need to retrieve chat memories outside the chat context, such as a sentiment analysis flow that retrieves and analyzes recently stored memories."}),"\n",(0,r.jsx)(n.li,{children:"You want to store memories in a specific database that is separate from Langflow storage."}),"\n"]}),(0,r.jsxs)(n.p,{children:["For more information, see ",(0,r.jsx)(n.a,{href:"/memory#store-chat-memory",children:"Store chat memory"}),"."]})]}),"\n",(0,r.jsx)(n.h2,{id:"use-the-message-history-component-in-a-flow",children:"Use the Message History component in a flow"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Message History"})," component has two modes, depending on where you want to use it in your flow:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Retrieve mode"}),": The component retrieves chat messages from your Langflow database or external memory."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Store mode"}),": The component stores chat messages in your Langflow database or external memory."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This means that you need multiple ",(0,r.jsx)(n.strong,{children:"Message History"})," components in your flow if you want to both store and retrieve chat messages."]}),"\n",(0,r.jsxs)(c.A,{children:[(0,r.jsxs)(d.A,{value:"langflow",label:"Use Langflow storage",default:!0,children:[(0,r.jsxs)(n.p,{children:["The following steps explain how to create a chat-based flow that uses ",(0,r.jsx)(n.strong,{children:"Message History"})," components to store and retrieve chat memory from your Langflow installation's database:"]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create or edit a flow where you want to use chat memory."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["At the beginning of the flow, add a ",(0,r.jsx)(n.strong,{children:"Message History"})," component, and then set it to ",(0,r.jsx)(n.strong,{children:"Retrieve"})," mode."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Optional: In the ",(0,r.jsx)(n.strong,{children:"Message History"})," ",(0,r.jsx)(n.a,{href:"/concepts-components#component-menus",children:"component's header menu"}),", click ",(0,r.jsx)(i.A,{name:"SlidersHorizontal","aria-hidden":"true"})," ",(0,r.jsx)(n.strong,{children:"Controls"})," to enable parameters for memory sorting, filtering, and limits."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component, add a ",(0,r.jsx)(n.code,{children:"{memory}"})," variable to the ",(0,r.jsx)(n.strong,{children:"Template"})," field, and then connect the ",(0,r.jsx)(n.strong,{children:"Message History"})," output to the ",(0,r.jsx)(n.strong,{children:"memory"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component supplies instructions and context to LLMs, separate from chat messages passed through a ",(0,r.jsx)(n.strong,{children:"Chat Input"})," component.\nThe template can include any text and variables that you want to supply to the LLM, for example:"]}),"\n",(0,r.jsx)(p.Code,{codeConfig:x,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"You are a helpful assistant that answers questions.",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"Use markdown to format your answer, properly embedding images and urls.",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"History:",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"{memory}",props:{}}]}],lang:"text"},annotations:[]}]}),"\n",(0,r.jsxs)(n.p,{children:["Variables (",(0,r.jsx)(n.code,{children:"{variable}"}),") in the template dynamically add fields to the ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component so that your flow can receive definitions for those values from elsewhere, such as other components, Langflow global variables, or runtime input.\nFor more information, see ",(0,r.jsx)(n.a,{href:"/components-prompts#define-variables-in-prompts",children:"Define variables in prompts"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In this example, the ",(0,r.jsx)(n.code,{children:"{memory}"})," variable is populated by the retrieved chat memories, which are then passed to a ",(0,r.jsx)(n.strong,{children:"Language Model"})," or ",(0,r.jsx)(n.strong,{children:"Agent"})," component to provide additional context to the LLM."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component's output to a ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's ",(0,r.jsx)(n.strong,{children:"System Message"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["This example uses the ",(0,r.jsx)(n.strong,{children:"Language Model"})," core component as the central chat driver, but you can also use another language model component or the ",(0,r.jsx)(n.strong,{children:"Agent"})," component."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a ",(0,r.jsx)(n.strong,{children:"Chat Input"})," component, and then connect it to the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's ",(0,r.jsx)(n.strong,{children:"Input"})," field."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's output to a ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["At the end of the flow, add another ",(0,r.jsx)(n.strong,{children:"Message History"})," component, and then set it to ",(0,r.jsx)(n.strong,{children:"Store"})," mode."]}),"\n",(0,r.jsxs)(n.p,{children:["Configure any additional parameters in the second ",(0,r.jsx)(n.strong,{children:"Message History"})," component as needed, taking into consideration that this particular component will store chat messages rather than retrieve them."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component's output to the ",(0,r.jsx)(n.strong,{children:"Message History"})," component's ",(0,r.jsx)(n.strong,{children:"Message"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["Each response from the LLM is output from the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component to the ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component, and then stored in chat memory by the final ",(0,r.jsx)(n.strong,{children:"Message History"})," component."]}),"\n"]}),"\n"]})]}),(0,r.jsxs)(d.A,{value:"external",label:"Use external chat memory",children:[(0,r.jsxs)(n.p,{children:["To store and retrieve chat memory from a dedicated, external chat memory database, use the ",(0,r.jsx)(n.strong,{children:"Message History"})," component ",(0,r.jsx)(n.em,{children:"and"})," a provider-specific chat memory component."]}),(0,r.jsxs)(n.p,{children:["The following steps explain how to create a flow that stores and retrieves chat memory from a ",(0,r.jsxs)(n.a,{href:"/bundles-redis",children:[(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component"]}),".\nOther options include the ",(0,r.jsxs)(n.a,{href:"/bundles-mem0",children:[(0,r.jsx)(n.strong,{children:"Mem0 Chat Memory"})," component"]})," and ",(0,r.jsxs)(n.a,{href:"/bundles-cassandra#cassandra-chat-memory",children:[(0,r.jsx)(n.strong,{children:"Cassandra Chat Memory"})," component"]}),"."]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Create or edit a flow where you want to use chat memory."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["At the beginning of the flow, add a ",(0,r.jsx)(n.strong,{children:"Message History"})," component and a ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure the ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component to connect to your Redis database. For more information, see the ",(0,r.jsx)(n.a,{href:"https://redis.io/docs/latest/",children:"Redis documentation"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Message History"})," component to ",(0,r.jsx)(n.strong,{children:"Retrieve"})," mode."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.strong,{children:"Message History"})," ",(0,r.jsx)(n.a,{href:"/concepts-components#component-menus",children:"component's header menu"}),", click ",(0,r.jsx)(i.A,{name:"SlidersHorizontal","aria-hidden":"true"})," ",(0,r.jsx)(n.strong,{children:"Controls"}),", enable ",(0,r.jsx)(n.strong,{children:"External Memory"}),", and then click ",(0,r.jsx)(n.strong,{children:"Close"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.strong,{children:"Controls"}),", you can also enable parameters for memory sorting, filtering, and limits."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component's output to the ",(0,r.jsx)(n.strong,{children:"Message History"})," component's ",(0,r.jsx)(n.strong,{children:"External Memory"})," input."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component, add a ",(0,r.jsx)(n.code,{children:"{memory}"})," variable to the ",(0,r.jsx)(n.strong,{children:"Template"})," field, and then connect the ",(0,r.jsx)(n.strong,{children:"Message History"})," output to the ",(0,r.jsx)(n.strong,{children:"memory"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component supplies instructions and context to LLMs, separate from chat messages passed through a ",(0,r.jsx)(n.strong,{children:"Chat Input"})," component.\nThe template can include any text and variables that you want to supply to the LLM, for example:"]}),"\n",(0,r.jsx)(p.Code,{codeConfig:x,northPanel:{tabs:[""],active:"",heightRatio:1},files:[{name:"",focus:"",code:{lines:[{tokens:[{content:"You are a helpful assistant that answers questions.",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"Use markdown to format your answer, properly embedding images and urls.",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"History:",props:{}}]},{tokens:[{content:"",props:{}}]},{tokens:[{content:"{memory}",props:{}}]}],lang:"text"},annotations:[]}]}),"\n",(0,r.jsxs)(n.p,{children:["Variables (",(0,r.jsx)(n.code,{children:"{variable}"}),") in the template dynamically add fields to the ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component so that your flow can receive definitions for those values from elsewhere, such as other components, Langflow global variables, or runtime input.\nFor more information, see ",(0,r.jsx)(n.a,{href:"/components-prompts#define-variables-in-prompts",children:"Define variables in prompts"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In this example, the ",(0,r.jsx)(n.code,{children:"{memory}"})," variable is populated by the retrieved chat memories, which are then passed to a ",(0,r.jsx)(n.strong,{children:"Language Model"})," or ",(0,r.jsx)(n.strong,{children:"Agent"})," component to provide additional context to the LLM."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Prompt Template"})," component's output to a ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's ",(0,r.jsx)(n.strong,{children:"System Message"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["This example uses the ",(0,r.jsx)(n.strong,{children:"Language Model"})," core component as the central chat driver, but you can also use another language model component or the ",(0,r.jsx)(n.strong,{children:"Agent"})," component."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add a ",(0,r.jsx)(n.strong,{children:"Chat Input"})," component, and then connect it to the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's ",(0,r.jsx)(n.strong,{children:"Input"})," input."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component's output to a ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["At the end of the flow, add another pair of ",(0,r.jsx)(n.strong,{children:"Message History"})," and ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," components:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Configure the ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component to connect to your Redis database."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Set the ",(0,r.jsx)(n.strong,{children:"Message History"})," component to ",(0,r.jsx)(n.strong,{children:"Store"})," mode."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.strong,{children:"Message History"})," ",(0,r.jsx)(n.a,{href:"/concepts-components#component-menus",children:"component's header menu"}),", click ",(0,r.jsx)(i.A,{name:"SlidersHorizontal","aria-hidden":"true"})," ",(0,r.jsx)(n.strong,{children:"Controls"}),", enable ",(0,r.jsx)(n.strong,{children:"External Memory"}),", and then click ",(0,r.jsx)(n.strong,{children:"Close"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Configure any additional parameters in this component as needed, taking into consideration that this particular component will store chat messages rather than retrieve them."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," component to the ",(0,r.jsx)(n.strong,{children:"Message History"})," component's ",(0,r.jsx)(n.strong,{children:"External Memory"})," input."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Connect the ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component's output to the ",(0,r.jsx)(n.strong,{children:"Message History"})," component's ",(0,r.jsx)(n.strong,{children:"Message"})," input."]}),"\n",(0,r.jsxs)(n.p,{children:["Each response from the LLM is output from the ",(0,r.jsx)(n.strong,{children:"Language Model"})," component to the ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component, and then stored in chat memory by passing it to the final ",(0,r.jsx)(n.strong,{children:"Message History"})," and ",(0,r.jsx)(n.strong,{children:"Redis Chat Memory"})," components."]}),"\n"]}),"\n"]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"A flow with Message History and Redis Chat Memory components",src:t(96841).A+"",width:"4000",height:"1768"})})]})]}),"\n",(0,r.jsx)(n.h2,{id:"message-history-parameters",children:"Message History parameters"}),"\n",(0,r.jsx)(l.Ay,{}),"\n",(0,r.jsxs)(n.p,{children:["The available parameters depend on whether the component is in ",(0,r.jsx)(n.strong,{children:"Retrieve"})," or ",(0,r.jsx)(n.strong,{children:"Store"})," mode."]}),"\n",(0,r.jsxs)(c.A,{children:[(0,r.jsx)(d.A,{value:"retrieve",label:"Retrieve mode",children:(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Template"})," (",(0,r.jsx)(n.code,{children:"template"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The template to use for formatting the data. It can contain the keys ",(0,r.jsx)(n.code,{children:"{text}"}),", ",(0,r.jsx)(n.code,{children:"{sender}"})," or any other key in the message data."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"External Memory"})," (",(0,r.jsx)(n.code,{children:"memory"}),")"]}),(0,r.jsx)(n.td,{children:"External Memory"}),(0,r.jsx)(n.td,{children:"Input parameter. Retrieve messages from an external memory. If empty, Langflow storage is used."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Number of Messages"})," (",(0,r.jsx)(n.code,{children:"n_messages"}),")"]}),(0,r.jsx)(n.td,{children:"Integer"}),(0,r.jsx)(n.td,{children:"Input parameter. The number of messages to retrieve. Default: 100."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Order"})," (",(0,r.jsx)(n.code,{children:"order"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The order of the messages. Default: ",(0,r.jsx)(n.code,{children:"Ascending"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Sender Type"})," (",(0,r.jsx)(n.code,{children:"sender_type"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. Filter by sender type, one of ",(0,r.jsx)(n.code,{children:"User"}),", ",(0,r.jsx)(n.code,{children:"Machine"}),", or ",(0,r.jsx)(n.code,{children:"Machine and User"})," (default)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Session ID"})," (",(0,r.jsx)(n.code,{children:"session_id"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The ",(0,r.jsx)(n.a,{href:"/session-id",children:"session ID"})," of the chat memories to retrieve. If omitted or empty, the current session ID for the flow run is used."]})]})]})]})}),(0,r.jsx)(d.A,{value:"store",label:"Store mode",children:(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Name"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Template"})," (",(0,r.jsx)(n.code,{children:"template"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The template to use for formatting the data. It can contain the keys ",(0,r.jsx)(n.code,{children:"{text}"}),", ",(0,r.jsx)(n.code,{children:"{sender}"})," or any other key in the message data."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Message"})," (",(0,r.jsx)(n.code,{children:"message"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The message to store, typically provided by connecting a ",(0,r.jsx)(n.strong,{children:"Chat Output"})," component."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"External Memory"})," (",(0,r.jsx)(n.code,{children:"memory"}),")"]}),(0,r.jsx)(n.td,{children:"External Memory"}),(0,r.jsx)(n.td,{children:"Input parameter. Store messages in external memory. If empty, Langflow storage is used."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Sender"})," (",(0,r.jsx)(n.code,{children:"sender"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. Choose which messages to store based on sender, one of ",(0,r.jsx)(n.code,{children:"User"}),", ",(0,r.jsx)(n.code,{children:"Machine"}),", or ",(0,r.jsx)(n.code,{children:"Machine and User"})," (default)."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Sender Name"})," (",(0,r.jsx)(n.code,{children:"sender_name"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. A backup ",(0,r.jsx)(n.code,{children:"sender"})," label to use if a message doesn't have sender metadata."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Session ID"})," (",(0,r.jsx)(n.code,{children:"session_id"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. The ",(0,r.jsx)(n.a,{href:"/session-id",children:"session ID"})," of the chat memories to store. If omitted or empty, the current session ID for the flow run is used. Use custom session IDs if you need to segregate chat memory for different users or applications that run the same flow."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.strong,{children:"Sender Type"})," (",(0,r.jsx)(n.code,{children:"sender_type"}),")"]}),(0,r.jsx)(n.td,{children:"String"}),(0,r.jsxs)(n.td,{children:["Input parameter. Filter by sender type, one of ",(0,r.jsx)(n.code,{children:"User"}),", ",(0,r.jsx)(n.code,{children:"Machine"}),", or ",(0,r.jsx)(n.code,{children:"Machine and User"})," (default)."]})]})]})]})})]}),"\n",(0,r.jsx)(n.h2,{id:"message-history-output",children:"Message History output"}),"\n",(0,r.jsx)(n.p,{children:"Memories can be retrieved in one of two formats:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Message"}),": Retrieve memories as ",(0,r.jsx)(n.code,{children:"Message"})," objects, including ",(0,r.jsx)(n.code,{children:"messages_text"})," containing retrieved chat message text.\nThis is the typical output format used to pass memories ",(0,r.jsx)(n.em,{children:"as chat messages"})," to another component."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"DataFrame"}),": Returns memories as a ",(0,r.jsx)(n.code,{children:"DataFrame"})," containing the message data.\nUseful for cases where you need to retrieve memories in a tabular format rather than as chat messages."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"You can set the output type near the component's output port."})]})}function f(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(j,{...e})}):j(e)}function y(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},96841:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/component-message-history-external-memory-7e32402d0b6e819f5539adfbfbd3620f.png"}}]);